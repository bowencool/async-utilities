import{d as b,r as E,c as o,F as h,a as c}from"./runtime-core.esm-bundler.6c7eec45.js";class m extends Error{constructor(e){super(e);this.name="AbortError"}}class f extends Error{constructor(e){super(e);this.name="TimeoutError"}}function T(t,e={}){return function(...n){return new Promise((d,a)=>{let i;function s(){a(new m("aborted"))}function g(){a(new f(`timeout of ${e.timeout}ms`))}typeof e.timeout=="number"&&e.timeout>0&&(i=setTimeout(g,e.timeout)),e.signal&&e.signal.addEventListener("abort",s);function l(){i&&clearTimeout(i),e.signal&&e.signal.removeEventListener("abort",s)}t.call(this,...n).then((...u)=>{d(...u),l()}).catch((...u)=>{a(...u),l()})})}}function A(t=1e3){return new Promise(e=>{console.log(`The task will be completed in ${t}ms`),setTimeout(()=>e(`The result in ${t}ms`),t)})}var F=b({setup(){let t;const e=E({loading:!1,error:null,data:""});return()=>o(h,null,[o("p",null,[c("fetch\u3001xhr \u539F\u751F\u5C31\u53EF\u4EE5\u53D6\u6D88\uFF0C\u6240\u4EE5\u8FD9\u91CC\u5C31\u4E0D\u7528 HTTP \u505A\u793A\u4F8B\u4E86")]),o("button",{onClick:async function(){if(!e.loading){t=new AbortController;try{e.loading=!0,e.error=null,e.data=await T(A,{timeout:2e3,signal:t.signal})(1900+Math.floor(Math.random()*200))}catch(r){console.log(r.name,r.message,r instanceof f,r instanceof m),e.error=r,e.data=""}finally{e.loading=!1}}},disabled:e.loading?!0:void 0},[e.loading?"loading...":"start"]),e.loading&&o("button",{onClick:()=>{t.abort()}},[c("stop")]),o("pre",null,[JSON.stringify(e,(r,n)=>n instanceof Error?n.message:n,2)])])}});export{F as default};
